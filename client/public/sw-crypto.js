(()=>{var jt=Object.defineProperty;var vt=(t,e,n)=>e in t?jt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var _=(t,e,n)=>vt(t,typeof e!="symbol"?e+"":e,n);var X=BigInt(4294967295),lt=BigInt(32);function Mt(t,e=!1){return e?{h:Number(t&X),l:Number(t>>lt&X)}:{h:Number(t>>lt&X)|0,l:Number(t&X)|0}}function at(t,e=!1){let n=t.length,r=new Uint32Array(n),o=new Uint32Array(n);for(let c=0;c<n;c++){let{h:s,l:i}=Mt(t[c],e);[r[c],o[c]]=[s,i]}return[r,o]}var dt=(t,e,n)=>t<<n|e>>>32-n,pt=(t,e,n)=>e<<n|t>>>32-n,ht=(t,e,n)=>e<<n-32|t>>>64-n,yt=(t,e,n)=>t<<n-32|e>>>64-n;function gt(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Y(t,e=""){if(!Number.isSafeInteger(t)||t<0){let n=e&&`"${e}" `;throw new Error(`${n}expected integer >= 0, got ${t}`)}}function O(t,e,n=""){let r=gt(t),o=t?.length,c=e!==void 0;if(!r||c&&o!==e){let s=n&&`"${n}" `,i=c?` of length ${e}`:"",a=r?`length=${o}`:`type=${typeof t}`;throw new Error(s+"expected Uint8Array"+i+", got "+a)}return t}function J(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function xt(t,e){O(t,void 0,"digestInto() output");let n=e.outputLen;if(t.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function D(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function W(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}var $t=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Xt(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Dt(t){for(let e=0;e<t.length;e++)t[e]=Xt(t[e]);return t}var tt=$t?t=>t:Dt;function et(t,e={}){let n=(o,c)=>t(c).update(o).digest(),r=t(void 0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=o=>t(o),Object.assign(n,e),Object.freeze(n)}function bt(t=32){let e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof e?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(t))}var F=t=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,t])});var Vt=BigInt(0),N=BigInt(1),Zt=BigInt(2),zt=BigInt(7),Gt=BigInt(256),qt=BigInt(113),At=[],kt=[],Et=[];for(let t=0,e=N,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],At.push(2*(5*r+n)),kt.push((t+1)*(t+2)/2%64);let o=Vt;for(let c=0;c<7;c++)e=(e<<N^(e>>zt)*qt)%Gt,e&Zt&&(o^=N<<(N<<BigInt(c))-N);Et.push(o)}var Bt=at(Et,!0),Qt=Bt[0],Yt=Bt[1],wt=(t,e,n)=>n>32?ht(t,e,n):dt(t,e,n),mt=(t,e,n)=>n>32?yt(t,e,n):pt(t,e,n);function Jt(t,e=24){let n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let s=0;s<10;s++)n[s]=t[s]^t[s+10]^t[s+20]^t[s+30]^t[s+40];for(let s=0;s<10;s+=2){let i=(s+8)%10,a=(s+2)%10,w=n[a],f=n[a+1],p=wt(w,f,1)^n[i],b=mt(w,f,1)^n[i+1];for(let d=0;d<50;d+=10)t[s+d]^=p,t[s+d+1]^=b}let o=t[2],c=t[3];for(let s=0;s<24;s++){let i=kt[s],a=wt(o,c,i),w=mt(o,c,i),f=At[s];o=t[f],c=t[f+1],t[f]=a,t[f+1]=w}for(let s=0;s<50;s+=10){for(let i=0;i<10;i++)n[i]=t[s+i];for(let i=0;i<10;i++)t[s+i]^=~n[(i+2)%10]&n[(i+4)%10]}t[0]^=Qt[r],t[1]^=Yt[r]}W(n)}var V=class t{constructor(e,n,r,o=!1,c=24){_(this,"state");_(this,"pos",0);_(this,"posOut",0);_(this,"finished",!1);_(this,"state32");_(this,"destroyed",!1);_(this,"blockLen");_(this,"suffix");_(this,"outputLen");_(this,"enableXOF",!1);_(this,"rounds");if(this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=o,this.rounds=c,Y(r,"outputLen"),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=D(this.state)}clone(){return this._cloneInto()}keccak(){tt(this.state32),Jt(this.state32,this.rounds),tt(this.state32),this.posOut=0,this.pos=0}update(e){J(this),O(e);let{blockLen:n,state:r}=this,o=e.length;for(let c=0;c<o;){let s=Math.min(n-this.pos,o-c);for(let i=0;i<s;i++)r[this.pos++]^=e[c++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:n,pos:r,blockLen:o}=this;e[r]^=n,(n&128)!==0&&r===o-1&&this.keccak(),e[o-1]^=128,this.keccak()}writeInto(e){J(this,!1),O(e),this.finish();let n=this.state,{blockLen:r}=this;for(let o=0,c=e.length;o<c;){this.posOut>=r&&this.keccak();let s=Math.min(r-this.posOut,c-o);e.set(n.subarray(this.posOut,this.posOut+s),o),this.posOut+=s,o+=s}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Y(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(xt(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,W(this.state)}_cloneInto(e){let{blockLen:n,suffix:r,outputLen:o,rounds:c,enableXOF:s}=this;return e||(e=new t(n,r,o,s,c)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=c,e.suffix=r,e.outputLen=o,e.enableXOF=s,e.destroyed=this.destroyed,e}},Ot=(t,e,n,r={})=>et(()=>new V(e,t,n),r);var Lt=Ot(6,136,32,F(8));var Tt=Ot(6,72,64,F(10));var _t=(t,e,n,r={})=>et((o={})=>new V(e,t,o.dkLen===void 0?n:o.dkLen,!0),r),Ht=_t(31,168,16,F(11)),Z=_t(31,136,32,F(12));function nt(t){if(!Number.isSafeInteger(t)||t<0||t>4294967295)throw new Error("wrong u32 integer:"+t);return t}function Ut(t){return nt(t),(t&t-1)===0&&t!==0}function rt(t,e){nt(t);let n=0;for(let r=0;r<e;r++,t>>>=1)n=n<<1|t&1;return n}function St(t){return nt(t),31-Math.clz32(t)}function It(t){let e=t.length;if(e<2||!Ut(e))throw new Error("n must be a power of 2 and greater than 1. Got "+e);let n=St(e);for(let r=0;r<e;r++){let o=rt(r,n);if(r<o){let c=t[r];t[r]=t[o],t[o]=c}}return t}var ot=(t,e)=>{let{N:n,roots:r,dit:o,invertButterflies:c=!1,skipStages:s=0,brp:i=!0}=e,a=St(n);if(!Ut(n))throw new Error("FFT: Polynomial size should be power of two");let w=o!==c;return f=>{if(f.length!==n)throw new Error("FFT: wrong Polynomial length");o&&i&&It(f);for(let p=0,b=1;p<a-s;p++){let d=o?p+1+s:a-p,B=1<<d,U=B>>1,I=n>>d;for(let L=0;L<n;L+=B)for(let u=0,l=b++;u<U;u++){let y=c?o?n-l:l:u*I,g=L+u,x=L+u+U,A=r[y],m=f[x],h=f[g];if(w){let k=t.mul(m,A);f[g]=t.add(h,k),f[x]=t.sub(h,k)}else c?(f[g]=t.add(m,h),f[x]=t.mul(t.sub(m,h),A)):(f[g]=t.add(h,m),f[x]=t.mul(t.sub(h,m),A))}}return!o&&i&&It(f),f}};var st=bt;function z(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}function Kt(t){return Uint8Array.from(t)}function C(t,...e){let n=o=>typeof o=="number"?o:o.bytesLen,r=e.reduce((o,c)=>o+n(c),0);return{bytesLen:r,encode:o=>{let c=new Uint8Array(r);for(let s=0,i=0;s<e.length;s++){let a=e[s],w=n(a),f=typeof a=="number"?o[s]:a.encode(o[s]);O(f,w,t),c.set(f,i),typeof a!="number"&&f.fill(0),i+=w}return c},decode:o=>{O(o,r,t);let c=[];for(let s of e){let i=n(s),a=o.subarray(0,i);c.push(typeof s=="number"?a:s.decode(a)),o=o.subarray(i)}return c}}}function G(t,e){let n=e*t.bytesLen;return{bytesLen:n,encode:r=>{if(r.length!==e)throw new Error(`vecCoder.encode: wrong length=${r.length}. Expected: ${e}`);let o=new Uint8Array(n);for(let c=0,s=0;c<r.length;c++){let i=t.encode(r[c]);o.set(i,s),i.fill(0),s+=i.length}return o},decode:r=>{O(r,n);let o=[];for(let c=0;c<r.length;c+=t.bytesLen)o.push(t.decode(r.subarray(c,c+t.bytesLen)));return o}}}function H(...t){for(let e of t)if(Array.isArray(e))for(let n of e)n.fill(0);else e.fill(0)}function ct(t){return(1<<t)-1}var we=Uint8Array.of();var Rt=t=>{let{newPoly:e,N:n,Q:r,F:o,ROOT_OF_UNITY:c,brvBits:s,isKyber:i}=t,a=(u,l=r)=>{let y=u%l|0;return(y>=0?y|0:l+y|0)|0},w=(u,l=r)=>{let y=a(u,l)|0;return(y>l>>1?y-l|0:y)|0};function f(){let u=e(n);for(let l=0;l<n;l++){let y=rt(l,s),g=BigInt(c)**BigInt(y)%BigInt(r);u[l]=Number(g)|0}return u}let p=f(),b={add:(u,l)=>a((u|0)+(l|0))|0,sub:(u,l)=>a((u|0)-(l|0))|0,mul:(u,l)=>a((u|0)*(l|0))|0,inv:u=>{throw new Error("not implemented")}},d={N:n,roots:p,invertButterflies:!0,skipStages:i?1:0,brp:!1},B=ot(b,{dit:!1,...d}),U=ot(b,{dit:!0,...d});return{mod:a,smod:w,nttZetas:p,NTT:{encode:u=>B(u),decode:u=>{U(u);for(let l=0;l<u.length;l++)u[l]=a(o*u[l]);return u}},bitsCoder:(u,l)=>{let y=ct(u),g=u*(n/8);return{bytesLen:g,encode:x=>{let A=new Uint8Array(g);for(let m=0,h=0,k=0,E=0;m<x.length;m++)for(h|=(l.encode(x[m])&y)<<k,k+=u;k>=8;k-=8,h>>=8)A[E++]=h&ct(k);return A},decode:x=>{let A=e(n);for(let m=0,h=0,k=0,E=0;m<x.length;m++)for(h|=x[m]<<k,k+=8;k>=u;k-=u,h>>=u)A[E++]=l.decode(h&y);return A}}}}},Wt=t=>(e,n)=>{n||(n=t.blockLen);let r=new Uint8Array(e.length+2);r.set(e);let o=e.length,c=new Uint8Array(n),s=t.create({}),i=0,a=0;return{stats:()=>({calls:i,xofs:a}),get:(w,f)=>(r[o+0]=w,r[o+1]=f,s.destroy(),s=t.create({}).update(r),i++,()=>(a++,s.xofInto(c))),clean:()=>{s.destroy(),H(c,r)}}},Ft=Wt(Ht);var T=256,S=3329,te=3303,ee=17,{mod:v,nttZetas:ne,NTT:K,bitsCoder:re}=Rt({N:T,Q:S,F:te,ROOT_OF_UNITY:ee,newPoly:t=>new Uint16Array(t),brvBits:7,isKyber:!0}),it={512:{N:T,Q:S,K:2,ETA1:3,ETA2:2,du:10,dv:4,RBGstrength:128},768:{N:T,Q:S,K:3,ETA1:2,ETA2:2,du:10,dv:4,RBGstrength:192},1024:{N:T,Q:S,K:4,ETA1:2,ETA2:2,du:11,dv:5,RBGstrength:256}},oe=t=>{if(t>=12)return{encode:n=>n,decode:n=>n};let e=2**(t-1);return{encode:n=>((n<<t)+S/2)/S,decode:n=>n*S+e>>>t}},P=t=>re(t,oe(t));function R(t,e){for(let n=0;n<T;n++)t[n]=v(t[n]+e[n])}function se(t,e){for(let n=0;n<T;n++)t[n]=v(t[n]-e[n])}function ce(t,e,n,r,o){let c=v(e*r*o+t*n),s=v(t*r+e*n);return{c0:c,c1:s}}function q(t,e){for(let n=0;n<T/2;n++){let r=ne[64+(n>>1)];n&1&&(r=-r);let{c0:o,c1:c}=ce(t[2*n+0],t[2*n+1],e[2*n+0],e[2*n+1],r);t[2*n+0]=o,t[2*n+1]=c}return t}function Nt(t){let e=new Uint16Array(T);for(let n=0;n<T;){let r=t();if(r.length%3)throw new Error("SampleNTT: unaligned block");for(let o=0;n<T&&o+3<=r.length;o+=3){let c=(r[o+0]>>0|r[o+1]<<8)&4095,s=(r[o+1]>>4|r[o+2]<<4)&4095;c<S&&(e[n++]=c),n<T&&s<S&&(e[n++]=s)}}return e}function j(t,e,n,r){let o=t(r*T/4,e,n),c=new Uint16Array(T),s=D(o),i=0;for(let a=0,w=0,f=0,p=0;a<s.length;a++){let b=s[a];for(let d=0;d<32;d++)f+=b&1,b>>=1,i+=1,i===r?(p=f,f=0):i===2*r&&(c[w++]=v(p-f),f=0,i=0)}if(i)throw new Error(`sampleCBD: leftover bits: ${i}`);return c}var ie=t=>{let{K:e,PRF:n,XOF:r,HASH512:o,ETA1:c,ETA2:s,du:i,dv:a}=t,w=P(1),f=P(a),p=P(i),b=C("publicKey",G(P(12),e),32),d=G(P(12),e),B=C("ciphertext",G(p,e),f),U=C("seed",32,32);return{secretCoder:d,lengths:{secretKey:d.bytesLen,publicKey:b.bytesLen,cipherText:B.bytesLen},keygen:I=>{O(I,32,"seed");let L=new Uint8Array(33);L.set(I),L[32]=e;let u=o(L),[l,y]=U.decode(u),g=[],x=[];for(let h=0;h<e;h++)g.push(K.encode(j(n,y,h,c)));let A=r(l);for(let h=0;h<e;h++){let k=K.encode(j(n,y,e+h,c));for(let E=0;E<e;E++){let M=Nt(A.get(E,h));R(k,q(M,g[E]))}x.push(k)}A.clean();let m={publicKey:b.encode([x,l]),secretKey:d.encode(g)};return H(l,y,g,x,L,u),m},encrypt:(I,L,u)=>{let[l,y]=b.decode(I),g=[];for(let E=0;E<e;E++)g.push(K.encode(j(n,u,E,c)));let x=r(y),A=new Uint16Array(T),m=[];for(let E=0;E<e;E++){let M=j(n,u,e+E,s),Q=new Uint16Array(T);for(let $=0;$<e;$++){let Pt=Nt(x.get(E,$));R(Q,q(Pt,g[$]))}R(M,K.decode(Q)),m.push(M),R(A,q(l[E],g[E])),H(Q)}x.clean();let h=j(n,u,2*e,s);R(h,K.decode(A));let k=w.decode(L);return R(k,h),H(l,g,A,h),B.encode([m,k])},decrypt:(I,L)=>{let[u,l]=B.decode(I),y=d.decode(L),g=new Uint16Array(T);for(let x=0;x<e;x++)R(g,q(y[x],K.encode(u[x])));return se(l,K.decode(g)),H(g,y,u),w.encode(l)}}};function ft(t){let e=ie(t),{HASH256:n,HASH512:r,KDF:o}=t,{secretCoder:c,lengths:s}=e,i=C("secretKey",s.secretKey,s.publicKey,32,32),a=32,w=64;return{info:{type:"ml-kem"},lengths:{...s,seed:64,msg:a,msgRand:a,secretKey:i.bytesLen},keygen:(f=st(w))=>{O(f,w,"seed");let{publicKey:p,secretKey:b}=e.keygen(f.subarray(0,32)),d=n(p),B=i.encode([b,p,d,f.subarray(32)]);return H(b,d),{publicKey:p,secretKey:B}},getPublicKey:f=>{let[p,b,d,B]=i.decode(f);return Uint8Array.from(b)},encapsulate:(f,p=st(a))=>{O(f,s.publicKey,"publicKey"),O(p,a,"message");let b=f.subarray(0,384*t.K),d=c.encode(c.decode(Kt(b)));if(!z(d,b))throw H(d),new Error("ML-KEM.encapsulate: wrong publicKey modulus");H(d);let B=r.create().update(p).update(n(f)).digest(),U=e.encrypt(f,p,B.subarray(32,64));return H(B.subarray(32)),{cipherText:U,sharedSecret:B.subarray(0,32)}},decapsulate:(f,p)=>{O(p,i.bytesLen,"secretKey"),O(f,s.cipherText,"cipherText");let b=i.bytesLen-96,d=b+32,B=n(p.subarray(b/2,d));if(!z(B,p.subarray(d,d+32)))throw new Error("invalid secretKey: hash check failed");let[U,I,L,u]=i.decode(p),l=e.decrypt(f,U),y=r.create().update(l).update(L).digest(),g=y.subarray(0,32),x=e.encrypt(I,l,y.subarray(32,64)),A=z(f,x),m=o.create({dkLen:32}).update(u).update(f).digest();return H(l,x,A?m:g),A?g:m}}}function fe(t,e,n){return Z.create({dkLen:t}).update(e).update(new Uint8Array([n])).digest()}var ut={HASH256:Lt,HASH512:Tt,KDF:Z,XOF:Ft,PRF:fe},Ie=ft({...ut,...it[512]}),Ct=ft({...ut,...it[768]}),Ue=ft({...ut,...it[1024]});self.noblePostQuantum={ml_kem768:Ct};})();
/*! Bundled license information:

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/post-quantum/utils.js:
@noble/post-quantum/_crystals.js:
@noble/post-quantum/ml-kem.js:
  (*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) *)
*/
